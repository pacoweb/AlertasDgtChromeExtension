var staticData = {
    oldnews: [{
        msg: "on_news",
        key: 1
    }, {
        msg: "on_olds",
        key: 0
    }],

    sorting: [{
        msg: "sor_news",
        key: "news"
    }, {
        msg: "sor_old",
        key: "olds"
    }, {
        msg: "sor_types",
        key: "types"
    }, {
        msg: "sor_levels",
        key: "levels"
    }, {
        msg: "sor_proximity",
        key: "proximity"
    }],

    sounds: [{
        msg: "so_claxon",
        file: "claxon.ogg"
    }, {
        msg: "so_arranque",
        file: "startengine.ogg"
    }, {
        msg: "so_speech",
        file: "speech"
    }],

    types: [{
        msg: "type_meteo",
        val: "METEOROLOGICA",
        key: 1
    }, {
        msg: "type_obras",
        val: "OBRAS",
        key: 2
    }, {
        msg: "type_retencion",
        val: "RETENCION",
        key: 3
    }, {
        msg: "type_cono",
        val: "CONO",
        key: 4
    }, {
        msg: "type_puertos",
        val: "PUERTOS DE MONTA\u00D1A",
        key: 5
    }],
    levels: [{
        msg: "lev_verde",
        val:"VERDE",
        key: 1,
        csscolor: "#008000"
    }, {
        msg: "lev_amarillo",
        val:"AMARILLO",
        key: 2,
        csscolor: "#FFFF00"
    }, {
        msg: "lev_rojo",
        val:"ROJO",
        key: 3,
        csscolor: "#FF0000"
    }, {
        msg: "lev_negro",
        val:"NEGRO",
        key: 4,
        csscolor: "#000000"
    }],
    ccaas: [{
        key: 15,
        msg: "ca_15",
        provs: [{
            key: 4,
            ma: "AL",
            msg: "prov_4",
            lat:36.8401632,lng:-2.467903999999976
        }, {
            key: 11,
            ma: "CA",
            msg: "prov_11",
            lat:36.5297156,lng:-6.292692600000009
        }, {
            key: 14,
            ma: "CO",
            msg: "prov_14",
            lat:-31.3989296,lng:-64.18212890000001
        }, {
            key: 18,
            ma: "GR",
            msg: "prov_18",
            lat:37.17648740000001,lng:-3.5979290999999876
        }, {
            key: 21,
            ma: "H",
            msg: "prov_21",
            lat:37.2571526,lng:-6.949522099999967
        }, {
            key: 23,
            ma: "J",
            msg: "prov_23",
            lat:37.7657389,lng:-3.789517700000033
        }, {
            key: 29,
            ma: "MA",
            msg: "prov_29",
            lat:36.7196484,lng:-4.420016300000043
        }, {
            key: 41,
            ma: "SE",
            msg: "prov_41",
            lat:37.38263999999999,lng:-5.9962950999999975
        }]
    }, {
        key: 6,
        msg: "ca_6",
        provs: [{
            key: 22,
            ma: "HU",
            msg: "prov_22",
            lat:42.1401024,lng:-0.40889800000002197
        }, {
            key: 44,
            ma: "TE",
            msg: "prov_44",
            lat:40.3441099,lng:-1.1069095999999945
        }, {
            key: 50,
            ma: "Z",
            msg: "prov_50",
            lat:41.6568307,lng:-0.879910099999961
        }]
    }, {
        key: 17,
        msg: "ca_17",
        provs: [{
            key: 35,
            ma: "GC",
            msg: "prov_35",
            lat:28.1248227,lng:-15.43000649999999
        }, {
            key: 38,
            ma: "TF",
            msg: "prov_38",
            lat:28.46981,lng:-16.254855799999973
        }]
    }, {
        key: 3,
        msg: "ca_3",
        provs: [{
            key: 39,
            ma: "S",
            msg: "prov_39",
            lat:43.1828396,lng:-3.9878426999999874
        }]
    }, {
        key: 11,
        msg: "ca_11",
        provs: [{
            key: 2,
            ma: "AB",
            msg: "prov_2",
            lat:38.9976516,lng:-1.86007010000003
        }, {
            key: 13,
            ma: "CR",
            msg: "prov_13",
            lat:38.9861083,lng:-3.927251599999977
        }, {
            key: 16,
            ma: "CU",
            msg: "prov_16",
            lat:-2.9,lng:-78.98333330000003
        }, {
            key: 19,
            ma: "GU",
            msg: "prov_19",
            lat:20.67359,lng:-103.34380299999998
        }, {
            key: 45,
            ma: "TO",
            msg: "prov_45",
            lat:41.6639383,lng:-83.55521199999998
        }]
    }, {
        key: 8,
        msg: "ca_8",
        provs: [{
            key: 5,
            ma: "AV",
            msg: "prov_5",
            lat:40.6564086,lng:-4.7004256999999825
        }, {
            key: 9,
            ma: "BU",
            msg: "prov_9",
            lat:42.3408923,lng:-3.699762299999975
        }, {
            key: 24,
            ma: "LE",
            msg: "prov_24",
            lat:21.123619,lng:-101.680496
        }, {
            key: 34,
            ma: "P",
            msg: "prov_34",
            lat:0.0,
            lng:0.0
        }, {
            key: 37,
            ma: "SA",
            msg: "prov_37",
            lat:40.9649681,lng:-5.663025299999958
        }, {
            key: 40,
            ma: "SG",
            msg: "prov_40",
            lat:40.9494272,lng:-4.1192092
        }, {
            key: 42,
            ma: "SO",
            msg: "prov_42",
            lat:41.7635982,lng:-2.4649206000000277
        }, {
            key: 47,
            ma: "VA",
            msg: "prov_47",
            lat:41.6529434,lng:-4.728381099999979
        }, {
            key: 49,
            ma: "ZA",
            msg: "prov_49",
            lat:41.5036834,lng:-5.743778099999986
        }]
    }, {
        key: 7,
        msg: "ca_7",
        provs: [{
            key: 8,
            ma: "B",
            msg: "prov_8",
            lat:41.387917,lng:2.1699187000000393
        }, {
            key: 17,
            ma: "GI",
            msg: "prov_17",
            lat:41.9817957,lng:2.823699900000065 
        }, {
            key: 25,
            ma: "L",
            msg: "prov_25",
            lat:41.61415179999999,lng:0.6257825000000139 
        }, {
            key: 43,
            ma: "T",
            msg: "prov_43",
            lat:41.1186629,lng:1.2453299999999672 
        }]
    }, {
        key: 18,
        msg: "ca_18",
        provs: [{
            key: 51,
            ma: "CE",
            msg: "prov_51",
            lat:35.8882475,lng:-5.3162201000000096 
        }]
    }, {
        key: 10,
        msg: "ca_10",
        provs: [{
            key: 28,
            ma: "M",
            msg: "prov_28",
            lat:40.4166909,lng:-3.70034540000006 
        }]
    }, {
        key: 5,
        msg: "ca_5",
        provs: [{
            key: 31,
            ma: "NA",
            msg: "prov_31",
            lat:42.6953909,lng:-1.6760690999999497 
        }]
    }, {
        key: 12,
        msg: "ca_12",
        provs: [{
            key: 3,
            ma: "A",
            msg: "prov_3",
            lat:38.34521,lng:-0.4809944999999516 
        }, {
            key: 12,
            ma: "CS",
            msg: "prov_12",
            lat:39.9860683,lng:-0.03602420000004258 
        }, {
            key: 46,
            ma: "V",
            msg: "prov_46",
            lat:39.4702393,lng:-0.37680490000002465 
        }]
    }, {
        key: 14,
        msg: "ca_14",
        provs: [{
            key: 6,
            ma: "BA",
            msg: "prov_6",
            lat:38.8785459,lng:-6.970183099999986 
        }, {
            key: 10,
            ma: "CC",
            msg: "prov_10",
            lat:39.4761789,lng:-6.370760399999995 
        }]
    }, {
        key: 1,
        msg: "ca_1",
        provs: [{
            key: 15,
            ma: "C",
            msg: "prov_15",
            lat:43.3708731,lng:-8.395835000000034 
        }, {
            key: 27,
            ma: "LU",
            msg: "prov_27",
            lat:43.01208680000001,lng:-7.555851399999938 
        }, {
            key: 32,
            ma: "OR",
            msg: "prov_32",
            lat:42.3399835,lng:-7.864707100000032 
        }, {
            key: 36,
            ma: "PO",
            msg: "prov_36",
            lat:42.4336554,lng:-8.648121199999991 
        }]
    }, {
        key: 13,
        msg: "ca_13",
        provs: [{
            key: 7,
            ma: "PM",
            msg: "prov_7",
            lat:39.5341789,lng:2.857710499999939 
        }]
    }, {
        key: 9,
        msg: "ca_9",
        provs: [{
            key: 26,
            ma: "LO",
            msg: "prov_26",
            lat:42.46858100000001,lng:-2.4421069999999645 
        }]
    }, {
        key: 19,
        msg: "ca_19",
        provs: [{
            key: 52,
            ma: "ML",
            msg: "prov_52",
            lat:35.2923388,lng:-2.938793799999985 
        }]
    }, {
        key: 4,
        msg: "ca_4",
        provs: [{
            key: 1,
            ma: "VI",
            msg: "prov_1",
            lat:42.9099989,lng:-2.69838679999998
        }, {
            key: 20,
            ma: "SS",
            msg: "prov_20",
            lat:43.0756299,lng:-2.223666699999967 
        }, {
            key: 48,
            ma: "BI",
            msg: "prov_48",
            lat:43.0756299,lng:-2.223666699999967
        }]
    }, {
        key: 2,
        msg: "ca_2",
        provs: [{
            key: 33,
            ma: "O",
            msg: "prov_33",
            lat:43.2504393,lng:-5.983257699999967 
        }]
    }, {
        key: 16,
        msg: "ca_16",
        provs: [{
            key: 30,
            ma: "MU",
            msg: "prov_30",
            lat:37.98344489999999,lng:-1.1298897000000352
        }]
    }],
    mapKey :"AIzaSyDbVN93qm5V2jS5U_aMsoIwDpvtEkCX2EY",
    spainFullExtentConfig : [-2285544.9581676,3184222.088917,649636.92757462,5532367.5975108],
    spainFullExtentPopup : [ -2246409.199691,3154870.2700596,571365.41062146,5600855.1748448]
};

var utils = 
{
    toRad: function(num){
		return num * Math.PI / 180;
	},
	calculateDistance : function (lat1, lon1, lat2, lon2)
	{
		var R = 6371; // km
		var dLat = this.toRad((lat2 - lat1));
		var dLon = this.toRad((lon2 - lon1));
		var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
			  Math.cos(this.toRad(lat1)) * Math.cos(this.toRad(lat2)) * 
			  Math.sin(dLon / 2) * Math.sin(dLon / 2); 
		var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
		
		return R * c;
	},
	uniqProvs : null,
    getJustProvs : function()
    {
        var provs = [];

        _.each(staticData.ccaas, function(ca)
        {
            _.each(ca.provs, function(prov)
            {
                provs.push(prov);
            });
        });

        return provs;
    },
    getMsg : function(msg)
    {
        if(_.isUndefined(chrome) || _.isUndefined(chrome.i18n))
            return msg;

        return chrome.i18n.getMessage(msg);
    },
    getKmsLiteral : function (a)
    {
        return _.sprintf(a.pki === a.pkf ? this.getMsg("txt_one_km_f") : this.getMsg("txt_kms_f"), a.pki, a.pkf);
    },
    getLocationText : function(a)
    {
        if(this.uniqProvs === null)
            this.uniqProvs = this.getJustProvs();

        var prov = _.find(this.uniqProvs, function(prv){ return prv.key === a.prov;});
        var pobText  = _.titleize(a.pob.toLowerCase());
        var provText = this.getMsg(prov.msg);

        if(a.pob.length === 0 || a.pob.toLowerCase() == provText.toLowerCase())
            return provText;

        return [pobText, 
            ," ("
            , _.titleize(provText)
            , ")"].join("");
    },
    getLevelCssClass : function(a){
        var level = _.find(staticData.levels, function(lv){
            return lv.key === a.lv;
        });

        return level.val.toLowerCase();
    },
    getLevelColor : function(levelKey){
        var level = _.find(staticData.levels, function(lv){
            return lv.key === levelKey;
        });

        return level.csscolor;
    },
    getMsgLevelLongText : function(a){
        return this.getMsg("just_lev_" + this.getLevelCssClass(a) + "_max");
    },
    getTitleText : function(a)
    {
        var buffer = [];

        if(a.cau.length > 0){
            buffer.push(_.titleize(_.sprintf(this.getMsg("txt_causa_f"), a.cau).toLowerCase()));
        }

        buffer.push("\n");
        buffer.push(a.via + " (" + this.getKmsLiteral(a) + ")");
        buffer.push("\n");
        buffer.push(_.capitalize(_.sprintf(this.getMsg("txt_sentido_f"), a.sen).toLowerCase()));
        
        if(a.hac.length > 0){
            buffer.push(", ");
            buffer.push(_.sprintf(this.getMsg("txt_hacia_f"), _.titleize(a.hac.toLowerCase())));
        }

        buffer.push("\n");
        buffer.push(_.titleize(_.sprintf(this.getMsg("txt_fcinicio_f"), a.fc_text).toLowerCase()));
        buffer.push("\n");
        buffer.push(this.getLocationText(a));
        buffer.push("\n");

        if(a.x !== 0.0 && a.y !== 0.0)
        {
            buffer.push(_.titleize(_.sprintf(this.getMsg("txt_coords_f"), a.x, a.y).toLowerCase())); 

            if(a.xyMode === 2){
                buffer.push(" -- ");
                buffer.push(this.getMsg("txt_coords_autoMode"));
            }
            else if(a.xyMode === 1){
                buffer.push(" -- ");
                buffer.push(this.getMsg("txt_coords_aproxMode"));           
            }
        }

        buffer.push();

        return buffer.join('');
    },
    fromNowText : function(a){
        return _.capitalize(moment(a.fc).startOf('second').fromNow());
    }
};
